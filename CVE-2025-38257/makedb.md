### 0. 准备工作：确保你的系统已安装必要的编译依赖

sudo apt-get update
sudo apt-get install build-essential kernel-package fakeroot libncurses5-dev libssl-dev ccache flex bison libelf-dev clang llvm

### 确保 codeql 在你的 PATH 环境变量中

### 1. 进入内核代码目录

cd /home/bigniu/project/linux

### 2. 切换到存在漏洞的 commit (修复前的版本)

git checkout e04c78d86a9699d136910cfc0bdcf01087e3267e~1

### 3. 清理编译环境

make mrproper

### 4. 生成默认的内核编译配置文件

make ARCH=s390 defconfig

make ARCH=s390 menuconfig

需要启用的内核参数是 **CONFIG_ZCRYPT**

```
Device Drivers  --->
    Cryptographic API  --->
        Hardware crypto devices  --->
            <*> Support for IBM S390 cryptographic hardware
```



### 5. 创建 CodeQL 数据库，仅编译目标文件

codeql database create /home/bigniu/project/db/db_2025_38257 --language=cpp --command="make ARCH=s390 LLVM=1 drivers/s390/crypto/pkey_api.o"
