/**
 * @name 检测特定函数中的def.length_bytes赋值
 * @description 检测cs_dsp_ctl_cache_init_multiple_offsets函数中是否存在def.length_bytes = 8的赋值语句
 * @kind problem
 * @problem.severity warning
 * @id cpp/def-length-bytes-assignment
 * @tags correctness
 */

import cpp

from Assignment assign, FieldAccess fieldAccess, Function func
where 
  // 检查函数名为cs_dsp_ctl_cache_init_multiple_offsets
  func.getName() = "cs_dsp_ctl_cache_init_multiple_offsets" and
  
  // 检查赋值语句在该函数中
  assign.getEnclosingFunction() = func and
  
  // 检查赋值的左边是字段访问
  assign.getLValue() = fieldAccess and
  
  // 检查字段名为length_bytes
  fieldAccess.getTarget().getName() = "length_bytes" and
  
  // 检查对象名为def
  fieldAccess.getQualifier().(VariableAccess).getTarget().getName() = "def" and
  
  // 检查赋值的右边是数字8
  assign.getRValue().(Literal).getValue() = "8"

select assign, "在函数 " + func.getName() + " 中发现 def.length_bytes = 8 赋值语句，根据patch应该删除此行"