/**
 * @name CVE-2025-38254
 * @description Detects cases where a pointer returned from 'drm_edid_raw' is dereferenced
 *              without a preceding null-check, potentially leading to a NULL pointer dereference
 *              and denial of service. It also flags missing bounds checks on EDID extension data
 *              that can lead to a buffer overflow.
 * @kind problem
 * @problem.severity error
 * @precision high
 * @id cpp/unvalidated-edid-access
 * @tags security
 *       correctness
 *       external/cwe/cwe-476
 *       external/cwe/cwe-120
 * @patch-commit 6847b3b6e84ef37451c074e6a8db3fbd250c8dbf
 * @source-file drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_helpers.c
 * @affected-function dm_helpers_read_local_edid
 * @kernel-config CONFIG_DRM_AMD_DC
 * @vulnerability-type null-pointer-dereference, buffer-overflow
 * @patch-diff |
 *     @@ -1029,6 +1029,10 @@ enum dc_edid_status dm_helpers_read_local_edid(
 *      			return EDID_NO_RESPONSE;
 *      
 *      		edid = drm_edid_raw(drm_edid); // FIXME: Get rid of drm_edid_raw()
 *     +		if (!edid ||
 *     +		    edid->extensions >= sizeof(sink->dc_edid.raw_edid) / EDID_LENGTH)
 *     +			return EDID_BAD_INPUT;
 *     +
 *      		sink->dc_edid.length = EDID_LENGTH * (edid->extensions + 1);
 *      		memmove(sink->dc_edid.raw_edid, (uint8_t *)edid, sink->dc_edid.length);
 * @references https://nvd.nist.gov/vuln/detail/CVE-2025-38254
 * @remediation
 * @patch-description |
 *     drm/amd/display: Add sanity checks for drm_edid_raw()
 *     When EDID is retrieved via drm_edid_raw(), it doesn't guarantee to
 *     return proper EDID bytes the caller wants: it may be either NULL (that
 *     leads to an Oops) or with too long bytes over the fixed size raw_edid
 *     array (that may lead to memory corruption).  The latter was reported
 *     actually when connected with a bad adapter.
 *     
 *     Add sanity checks for drm_edid_raw() to address the above corner
 *     cases, and return EDID_BAD_INPUT accordingly.
 *     
 *     Fixes: 48edb2a4256e ("drm/amd/display: switch amdgpu_dm_connector to use struct drm_edid")
 */