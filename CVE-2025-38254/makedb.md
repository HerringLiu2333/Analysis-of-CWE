### 0. 准备工作：确保你的系统已安装必要的编译依赖

sudo apt-get update
sudo apt-get install build-essential kernel-package fakeroot libncurses5-dev libssl-dev ccache flex bison libelf-dev clang llvm

### 确保 codeql 在你的 PATH 环境变量中

### 1. 进入内核代码目录

cd /home/bigniu/project/linux

### 2. 切换到存在漏洞的 commit (修复前的版本)

git checkout 6847b3b6e84ef37451c074e6a8db3fbd250c8dbf~1

### 3. 清理编译环境

make mrproper

### 4. 生成默认的内核编译配置文件

make defconfig

make menuconfig

需要启用的内核参数是 CONFIG_DRM_AMDGPU 和 CONFIG_DRM_AMD_DC。

```code
Device Drivers  --->
    Graphics support  --->
        <*> AMD GPU
        Display Engine and Multi-Monitor Support (AMD DC) --->
            [*] Enable new display engine
```



### 5. 创建 CodeQL 数据库，仅编译目标文件

codeql database create /home/bigniu/project/db/db_2025_38254 --language=cpp --command="make LLVM=1 drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm_helpers.o"
