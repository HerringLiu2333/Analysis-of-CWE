### **漏洞信息**

*   **CVE:** CVE-2025-38276
*   **Commit:** `dd59137bfe70cf3646021b4721e430213b9c71bd`
*   **影响文件:** `fs/dax.c`

### **准备工作**

1.  **确保你的系统已安装必要的编译依赖**

    ```bash
    sudo apt-get update
    sudo apt-get install build-essential kernel-package fakeroot libncurses5-dev libssl-dev ccache flex bison libelf-dev clang llvm
    ```

2.  **确保 codeql 在你的 PATH 环境变量中**

3.  **进入内核代码目录**

    ```bash
    cd /home/bigniu/project/linux
    ```

4.  **切换到存在漏洞的 commit (修复前的版本)**

    ```bash
    git checkout dd59137bfe70cf3646021b4721e430213b9c71bd~1
    ```

5.  **清理编译环境**

    ```bash
    make mrproper
    ```

---

### **模式一：编译模式 (Build Mode)**

1.  **生成默认的内核编译配置文件**

    ```bash
    make defconfig
    ```

2.  **make menuconfig**

    在 `make menuconfig` 界面中，需要启用内核参数 **CONFIG\_FS\_DAX**。DAX (Direct Access) 的支持通常内嵌在具体的文件系统中，例如 EXT4 或 XFS。你需要先启用一个支持 DAX 的文件系统，然后开启 DAX 选项。

    以启用 **EXT4** 的 DAX 为例：
    ```text
    File systems  --->
        <*> The Extended 4 (ext4) filesystem
        [*]   Ext4 POSIX Access Control Lists
        [*]   Ext4 Security Labels
        [ ]   EXT4 Encryption
        [ ]   EXT4 Verity
        [*]   FS-DAX support for ext4
    ```
    确保 `FS-DAX support for ext4` 或者其他文件系统的 DAX 支持被选中。

3.  **创建 CodeQL 数据库 (编译模式)**
    此命令仅编译生成漏洞相关的目标文件，效率较高。

    ```bash
    codeql database create /home/bigniu/project/db/db_2025_38276 --language=cpp --command="make LLVM=1 fs/dax.o"
    ```

---

### **模式二：无编译模式 (No-Build Mode)**

此模式无需进行 `make defconfig` 和 `make menuconfig` 等配置编译步骤，CodeQL 会直接分析指定文件夹中的源代码。

1.  **创建 CodeQL 数据库 (无编译模式)**
    针对漏洞文件的上级文件夹 `fs` 创建数据库。

    ```bash
    codeql database create /home/niuniu/cve/db_none_38246 --language=cpp --source-root=/home/niuniu/linux/fs --build-mode=none
    ```